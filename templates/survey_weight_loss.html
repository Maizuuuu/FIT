{% extends "base.html" %}

{% block content %}
<form action="/survey/weight-loss" method="POST" class="survey-container">
  <h1 class="survey-title">üî• –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ—Ö—É–¥–µ–Ω–∏—è</h1>
  
  <!-- –°–µ–∫—Ü–∏—è: –ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞ -->
  <section class="survey-section">
    <h2>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞</h2>
    <div class="form-group">
      <label class="question">–í–≤–µ–¥–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –æ–ø—Ä–æ—Å–∞:</label>
      <input type="text" name="survey_name" class="form-input" required>
    </div>
  </section>
  
  <div class="section-divider"></div>

  <section class="survey-section">
    <h2>1. –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>

    <div class="form-group">
      <label class="question">1.1. –í–∞—à –≤–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç):</label>
      <input type="number" name="age" min="18" max="100" class="form-input" required>
    </div>

    <div class="form-group">
      <label class="question">1.2. –¢–µ–∫—É—â–∏–π –≤–µ—Å (–∫–≥):</label>
      <input type="number" name="current_weight" min="30" max="300" class="form-input" required>
    </div>

    <div class="form-group">
      <label class="question">1.3. –ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–∫–≥):</label>
      <input type="number" name="target_weight" min="30" max="300" class="form-input" required>
    </div>

    <div class="form-group">
      <label class="question">1.4. –£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</label>
      <div class="radio-group">
        <label><input type="radio" name="activity" value="low" required> –°–∏–¥—è—á–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</label>
        <label><input type="radio" name="activity" value="medium"> –£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
        <label><input type="radio" name="activity" value="high"> –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- –°–µ–∫—Ü–∏—è 2: –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è -->
  <section class="survey-section">
    <h2>2. –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</h2>

    <div class="form-group">
      <label class="question">2.1. –ï—Å—Ç—å –ª–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ —Å–ø–æ—Ä—Ç—É?</label>
      <div class="radio-group">
        <label><input type="radio" name="health_issues" value="yes" required> –î–∞</label>
        <label><input type="radio" name="health_issues" value="no"> –ù–µ—Ç</label>
      </div>
    </div>

    <div class="form-group">
      <label class="question">2.2. –ï—Å–ª–∏ ¬´–î–∞¬ª, —É–∫–∞–∂–∏—Ç–µ –∫–∞–∫–∏–µ:</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="restrictions" value="heart"> –ë–æ–ª–µ–∑–Ω–∏ —Å–µ—Ä–¥—Ü–∞</label>
        <label><input type="checkbox" name="restrictions" value="joints"> –ü—Ä–æ–±–ª–µ–º—ã —Å —Å—É—Å—Ç–∞–≤–∞–º–∏</label>
        <label><input type="checkbox" name="restrictions" value="diabetes"> –î–∏–∞–±–µ—Ç</label>
        <label><input type="checkbox" name="restrictions" value="other"> –î—Ä—É–≥–æ–µ: 
          <input type="text" name="other_restriction" class="form-input-small">
        </label>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- –°–µ–∫—Ü–∏—è 3: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö -->
  <section class="survey-section">
    <h2>3. –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</h2>

    <div class="form-group">
      <label class="question">3.1. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø—ã –Ω–∞–≥—Ä—É–∑–æ–∫:</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="workout_types" value="cardio"> –ö–∞—Ä–¥–∏–æ</label>
        <label><input type="checkbox" name="workout_types" value="strength"> –°–∏–ª–æ–≤—ã–µ</label>
        <label><input type="checkbox" name="workout_types" value="yoga"> –ô–æ–≥–∞/–†–∞—Å—Ç—è–∂–∫–∞</label>
        <label><input type="checkbox" name="workout_types" value="home"> –î–æ–º–∞—à–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
      </div>
    </div>

    <div class="form-group">
      <label class="question">3.2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É:</label>
      <select name="workout_time" class="form-select" required>
        <option value="20">20 –º–∏–Ω—É—Ç</option>
        <option value="30">30 –º–∏–Ω—É—Ç</option>
        <option value="45">45 –º–∏–Ω—É—Ç</option>
        <option value="60">60 –º–∏–Ω—É—Ç</option>
      </select>
    </div>
  </section>

  <div class="section-divider"></div>

  <button type="submit" class="btn btn-primary survey-submit">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω</button>
</form>
<script src="{{ url_for('static', filename='js/survey_logic.js') }}"></script>
<script>
function validateForm() {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
  const requiredFields = [
    {name: 'survey_name', label: '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞'},
    {name: 'age', label: '–í–æ–∑—Ä–∞—Å—Ç'},
    {name: 'current_weight', label: '–¢–µ–∫—É—â–∏–π –≤–µ—Å'},
    {name: 'target_weight', label: '–ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å'},
    {name: 'activity', label: '–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏', isRadio: true},
    {name: 'health_issues', label: '–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è', isRadio: true}
  ];

  for (const field of requiredFields) {
    if (field.isRadio) {
      if (!document.querySelector(`[name="${field.name}"]:checked`)) {
        alert(`–ü–æ–ª–µ "${field.label}" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!`);
        return false;
      }
    } else {
      const value = document.querySelector(`[name="${field.name}"]`).value.trim();
      if (!value) {
        alert(`–ü–æ–ª–µ "${field.label}" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!`);
        return false;
      }
    }
  }

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
  const age = parseInt(document.querySelector('[name="age"]').value);
  if (age < 14 || age > 100) {
    alert("–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 14 –¥–æ 100 –ª–µ—Ç");
    return false;
  }

  const currentWeight = parseInt(document.querySelector('[name="current_weight"]').value);
  const targetWeight = parseInt(document.querySelector('[name="target_weight"]').value);
  
  if (currentWeight < 30 || currentWeight > 300) {
    alert("–¢–µ–∫—É—â–∏–π –≤–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 30 –¥–æ 300 –∫–≥");
    return false;
  }

  if (targetWeight >= currentWeight) {
    alert("–ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ!");
    return false;
  }

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
  const healthIssues = document.querySelector('[name="health_issues"]:checked').value;
  if (healthIssues === 'yes') {
    const restrictions = document.querySelectorAll('[name="restrictions"]:checked');
    if (restrictions.length === 0) {
      alert("–£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–µ");
      return false;
    }
  }

  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
  const workoutTypes = document.querySelectorAll('[name="workout_types"]:checked');
  if (workoutTypes.length === 0) {
    alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫");
    return false;
  }

  return true;
}

// –í–µ—à–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —Ñ–æ—Ä–º—É
document.querySelector('form').addEventListener('submit', function(e) {
  if (!validateForm()) {
    e.preventDefault();
  }
});
</script>
<script>
function validateForm() {
  const name = document.querySelector('[name="survey_name"]').value;
  const age = document.querySelector('[name="age"]').value;
  if (!name || !age) {
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!");
    return false;
  }
  return true;
}
</script>
{% endblock %}